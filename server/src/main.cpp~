#include <Ecore.h>
#include <dlog.h>
#include <thread>
#include "oduinoSerialReader.h"

#define LOG_TAG		"chameleonD" 
#define DLOG_ERR	DLOG_ERROR
#define PRT_ERR(fmt, arg...) \
	do { SLOG(LOG_ERR, LOG_TAG, fmt, ##arg); } while (0)

Ecore_Timer         *redraw_timer     = NULL;
Ecore_Event_Handler *handler   = NULL;
SerialReader serialReader;
int temp=0, hum=0;

Eina_Bool
redrawScreen(void *data)
{
   temp = serialReader.get_Temperature();
   hum = serialReader.get_Humidity();
PRT_ERR("Temperature %d, Humidity %d\n",temp, hum);
   return ECORE_CALLBACK_RENEW;
}

Eina_Bool
exit_func(void *data, int ev_type, void *ev)
{
   Ecore_Event_Signal_Exit *e;

   e = (Ecore_Event_Signal_Exit *)ev;
   ecore_main_loop_quit();
   return 1;
}

int
main(int argc, const char **argv)
{
   ecore_init();
   ecore_app_args_set(argc, argv);
   handler = ecore_event_handler_add(ECORE_EVENT_SIGNAL_EXIT, exit_func, NULL);
   thread t1(serialReader.listen, NULL);
   redraw_timer = ecore_timer_add(1.5, redrawScreen, NULL);
   ecore_main_loop_begin();
   ecore_shutdown();
   return 0;
}

